commit fb8ddda3dbe6e30614c70feb6d228dd547eb8ad1
Author: Jamie Coldhill <wrxtasy@amnet.net.au>
Date:   Fri Apr 29 01:47:51 2016 +0800

    [amlogic_cec] Fix for stuck messages in read queue
    https://github.com/Raybuntu/linux/commit/8014786f5a2e7b5cbd94dd7c92cc3e3551353632

diff --git a/drivers/amlogic/hdmi/hdmi_tx_20/amlogic_cec.c b/drivers/amlogic/hdmi/hdmi_tx_20/amlogic_cec.c
index 39fa98a..de84658 100644
--- a/drivers/amlogic/hdmi/hdmi_tx_20/amlogic_cec.c
+++ b/drivers/amlogic/hdmi/hdmi_tx_20/amlogic_cec.c
@@ -458,8 +458,6 @@ static ssize_t amlogic_cec_read(struct file *file, char __user *buffer,
 
     retval = entry->size;
 
-    amlogic_cec_set_rx_state(STATE_RX);
-
 error_exit:
     if (entry != NULL)
     {
@@ -467,6 +465,11 @@ error_exit:
         kfree(entry);
     }
 
+    if (list_empty(&cec_rx_struct.list))
+      {
+          amlogic_cec_set_rx_state(STATE_RX);
+      }
+
     spin_unlock_irqrestore(&cec_rx_struct.lock, spin_flags);
 
     return retval;
@@ -560,8 +563,11 @@ static long amlogic_cec_ioctl(struct file *file, unsigned int cmd,
 
 static u32 amlogic_cec_poll(struct file *file, poll_table *wait)
 {
-    poll_wait(file, &cec_rx_struct.waitq, wait);
 
+    if (atomic_read(&cec_rx_struct.state) != STATE_DONE)
+     {
+         poll_wait(file, &cec_rx_struct.waitq, wait);
+    }
     if (atomic_read(&cec_rx_struct.state) == STATE_DONE)
     {
         return POLLIN | POLLRDNORM;
